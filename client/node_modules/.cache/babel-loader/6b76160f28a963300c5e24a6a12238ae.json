{"ast":null,"code":"import axios from 'axios';\nexport const createOrder = (razorpay_payment_id, cartItems, subTotal) => async (dispatch, getState) => {\n  dispatch({\n    type: \"ORDER_CREATE_REQUEST\"\n  });\n  const loginState = getState().loginReducer;\n  const {\n    currentUser\n  } = loginState;\n  const order = {\n    name: currentUser.name,\n    email: currentUser.email,\n    userId: currentUser._id,\n    orderItems: cartItems,\n    orderAmount: subTotal,\n    isDelivered: false,\n    transactionId: razorpay_payment_id\n  };\n\n  try {\n    const response = await axios.post(\"/api/orders/placeOrder\", order);\n    dispatch({\n      type: \"ORDER_CREATE_SUCCESS\",\n      payload: response.data\n    });\n  } catch (error) {\n    dispatch({\n      type: \"ORDER_CREATE_FAIL\",\n      payload: error\n    });\n  }\n\n  try {\n    const response = await axios.get(\"/api/inventory/getAllStock\"); //will continue after the above request is successfully served at the pizzaRouter.js\n\n    dispatch({\n      type: \"GET_STOCK_SUCCESS\",\n      payload: response.data\n    });\n    const {\n      stock\n    } = getState().getAllStockReducer; //calculating LOW stock\n\n    var s = \"** STOCK ALERT ** The following stock is low : \\n\";\n\n    for (var i = 0; i < stock.length; i++) {\n      var type = stock[i].name;\n      s += type + \" : \";\n      console.log(\"type : \" + type);\n      var obj = stock[i].varqty[0];\n\n      for (var j = 0; j < Object.keys(obj).length; j++) {\n        var name = Object.keys(obj)[j];\n        var value = obj[Object.keys(obj)[j]];\n        console.log(\"name : \" + name + \" value : \" + value);\n\n        if (value <= 10 && value != null) {\n          console.log(\"low\");\n          s += name + \"(\" + value + \") \";\n        }\n      }\n\n      s += \"    \\n\";\n    }\n\n    console.log(\"Stock Report......\", s); //now sending mail for updated stock\n\n    var mailobj = {\n      to: \"ekamjit105@gmail.com\",\n      subject: \"!! STOCK ALERT REPORT !!\",\n      text: s\n    };\n    response = await axios.post('/api/mail/sendmail', mailobj);\n    dispatch({\n      type: \"SEND_MAIL_SUCCESS\"\n    }); //empty the cart\n    //localStorage.setItem(\"cartItems\",[])\n    //window.location.href=\"/myorders\"\n  } catch (error) {\n    dispatch({\n      type: \"ORDER_CREATE_FAIL\",\n      payload: error\n    });\n  }\n\n  localStorage.setItem(\"cartItems\", []);\n  window.location.href = '/cart';\n};\nexport const getMyOrders = () => async (dispatch, getState) => {\n  dispatch({\n    type: \"GET_ORDER_REQUEST\"\n  });\n\n  try {\n    const {\n      currentUser\n    } = getState().loginReducer;\n    const userId = currentUser._id;\n    const response = await axios.post(\"/api/orders/myOrders\", {\n      userId\n    });\n    dispatch({\n      type: \"GET_ORDER_SUCCESS\",\n      payload: response.data\n    });\n  } catch (error) {\n    dispatch({\n      type: \"GET_ORDER_FAIL\",\n      payload: error\n    });\n  }\n};\nexport const getAllOrders = () => async (dispatch, getState) => {\n  // const currentUser = getState().loginUserReducer.currentUser;\n  dispatch({\n    type: \"ALL_ORDER_REQUEST\"\n  });\n\n  try {\n    const response = await axios.get(\"/api/orders/alluserorder\");\n    dispatch({\n      type: \"ALL_ORDER_SUCCESS\",\n      payload: response.data\n    });\n  } catch (error) {\n    dispatch({\n      type: \"ALL_ORDER_FAIL\",\n      payload: error\n    });\n  }\n};\nexport const deliverOrder = orderid => async (dispatch, getState) => {\n  // const currentUser = getState().loginUserReducer.currentUser;\n  dispatch({\n    type: \"GET_ALL_ORDER_REQUEST\"\n  });\n\n  try {\n    await axios.post(\"/api/orders/deliverorder\", {\n      orderid\n    });\n    alert(\"Delivered Success\");\n    const orders = await axios.get(\"/api/orders/alluserorder\");\n    dispatch({\n      type: \"GET_ALL_ORDER_SUCCESS\",\n      payload: orders.data\n    });\n    window.location.href = \"/admin/orderlist\";\n  } catch (error) {\n    dispatch({\n      type: \"GET_ALL_ORDER_FAIL\",\n      payload: error\n    });\n  }\n};","map":{"version":3,"sources":["C:/Users/ekamjit singh/Desktop/oibsip_level3task-main/pizza app/client/src/actions/orderAction.js"],"names":["axios","createOrder","razorpay_payment_id","cartItems","subTotal","dispatch","getState","type","loginState","loginReducer","currentUser","order","name","email","userId","_id","orderItems","orderAmount","isDelivered","transactionId","response","post","payload","data","error","get","stock","getAllStockReducer","s","i","length","console","log","obj","varqty","j","Object","keys","value","mailobj","to","subject","text","localStorage","setItem","window","location","href","getMyOrders","getAllOrders","deliverOrder","orderid","alert","orders"],"mappings":"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","sourcesContent":["import axios from 'axios'\n\nexport const createOrder = (razorpay_payment_id,cartItems, subTotal) =>async(dispatch,getState)=>{\n    dispatch({type:\"ORDER_CREATE_REQUEST\"})\n    const loginState = getState().loginReducer\n    const {currentUser} = loginState\n    const order ={\n        name:currentUser.name,\n        email:currentUser.email,\n        userId:currentUser._id,\n        orderItems:cartItems,\n        orderAmount:subTotal,\n        isDelivered:false,\n        transactionId:razorpay_payment_id\n    }\n    try {\n        const response = await axios.post(\"/api/orders/placeOrder\",order)\n        dispatch({type: \"ORDER_CREATE_SUCCESS\",payload:response.data})\n    } catch (error) {\n        dispatch({type:\"ORDER_CREATE_FAIL\",payload:error})        \n    }\n\n    try {\n      const response = await axios.get(\"/api/inventory/getAllStock\");\n        //will continue after the above request is successfully served at the pizzaRouter.js\n        \n        dispatch({type:\"GET_STOCK_SUCCESS\", payload:response.data})\n        const {stock} = getState().getAllStockReducer\n        \n\n\n        //calculating LOW stock\n        var s=\"** STOCK ALERT ** The following stock is low : \\n\";\n\n        for(var i=0;i<stock.length;i++)\n        {\n          var type=stock[i].name;\n          s+=type+\" : \";\n          console.log(\"type : \"+type)\n          \n          var obj = stock[i].varqty[0];\n\n\n          for(var j=0;j<Object.keys(obj).length;j++)\n          {\n            var name = Object.keys(obj)[j];\n              \n            var value = obj[Object.keys(obj)[j]];\n            console.log(\"name : \"+name+\" value : \"+value)\n            \n            if(value<=10 && value!=null)\n            {\n              console.log(\"low\");\n              s+=name+\"(\"+value+\") \";\n            }\n          }\n          s+=\"    \\n\";\n        }\n\n        console.log(\"Stock Report......\" , s)\n\n\n\n        //now sending mail for updated stock\n\n        \n        var mailobj = {\n          to : \"ekamjit105@gmail.com\",\n          subject : \"!! STOCK ALERT REPORT !!\",\n          text:s,\n        }\n\n        response =  await axios.post('/api/mail/sendmail',mailobj);\n        dispatch({ type: \"SEND_MAIL_SUCCESS\" });  \n        //empty the cart\n        \n        //localStorage.setItem(\"cartItems\",[])\n        //window.location.href=\"/myorders\"\n        \n    } catch (error) {\n        dispatch({type:\"ORDER_CREATE_FAIL\",payload:error})        \n    }\n\n    localStorage.setItem(\"cartItems\",[])\n    window.location.href='/cart'\n\n}\n\n\n\nexport const getMyOrders = () =>async(dispatch,getState)=>{\n \n    dispatch({type:\"GET_ORDER_REQUEST\"})\n    try {\n        const {currentUser} = getState().loginReducer\n       \n        const userId= currentUser._id\n        \n        const response = await axios.post(\"/api/orders/myOrders\",{userId})\n        \n        dispatch({type:\"GET_ORDER_SUCCESS\",payload:response.data})\n    } catch (error) {\n        dispatch({type:\"GET_ORDER_FAIL\",payload:error})\n        \n    }\n}\n\n\n\nexport const getAllOrders = () => async (dispatch, getState) => {\n    // const currentUser = getState().loginUserReducer.currentUser;\n    dispatch({\n      type: \"ALL_ORDER_REQUEST\",\n    });\n    try {\n      const response = await axios.get(\"/api/orders/alluserorder\");\n      dispatch({ type: \"ALL_ORDER_SUCCESS\", payload: response.data });\n    } catch (error) {\n      dispatch({ type: \"ALL_ORDER_FAIL\", payload: error });\n    }\n  };\n  \n  export const deliverOrder = (orderid) => async (dispatch, getState) => {\n    // const currentUser = getState().loginUserReducer.currentUser;\n    dispatch({\n      type: \"GET_ALL_ORDER_REQUEST\",\n    });\n    try {\n      await axios.post(\"/api/orders/deliverorder\", { orderid });\n      alert(\"Delivered Success\");\n      const orders = await axios.get(\"/api/orders/alluserorder\");\n      dispatch({ type: \"GET_ALL_ORDER_SUCCESS\", payload: orders.data });\n      window.location.href = \"/admin/orderlist\";\n    } catch (error) {\n      dispatch({ type: \"GET_ALL_ORDER_FAIL\", payload: error });\n    }\n  };\n  "]},"metadata":{},"sourceType":"module"}